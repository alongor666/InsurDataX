
# 车险经营分析周报 - 字段字典与计算逻辑 (V4.1)

**最后更新日期：** 2024-05-28

**核心原则：**

1.  **数据处理模式**：
    *   **累计值分析 (Cumulative Mode)**：
        *   **单选业务类型时**：对于下述定义的11项“原始核心指标”，优先直接使用JSON数据源中为该业务类型提供的对应年度累计 (YTD) 预计算值（如果JSON中存在且有效）。若JSON中对应值无效或缺失，则基于该单个业务类型的其他基础数据按指标定义进行计算。“保单件数”和“满期保单件数”始终按公式计算。
        *   **多选业务类型（2个及以上）或选择“全部业务类型”时**：
            *   首先，将所选范围（或全部独立业务线）的基础可累加字段（如：跟单保费、满期保费、总赔款、原始费用额、已报件数）的YTD值进行加总。
            *   然后，基于这些加总后的基础字段，严格按照各指标的定义重新计算所有11项“原始核心指标”（特别是其中的比率和均值类指标）。“保单件数”和“满期保单件数”则是对每个独立业务线计算后求和。
            *   “商业险平均自主系数”在聚合（多选或全部业务类型）时，显示为“-”。
    *   **当周发生额分析 (Period-over-Period Mode)**：
        *   所有指标（包括11项“原始核心指标”和所有“衍生指标”）都**必须**基于各基础字段的“当周发生额”（即 `当前周期YTD值 - 上一周期YTD值`）重新计算。此模式下不直接使用JSON中的任何YTD预计算率值或均值。
2.  **11项“原始核心指标”列表** (作为KPI看板的主要展示内容，其取值/计算遵循上述模式)：
    1.  `premium_written` (跟单保费)
    2.  `avg_premium_per_policy` (单均保费)
    3.  `premium_earned` (满期保费)
    4.  `claim_frequency` (满期出险频度)
    5.  `claim_count` (已报件数) - *同时作为KPI看板指标卡片之一*
    6.  `avg_loss_per_case` (案均赔款)
    7.  `total_loss_amount` (总赔款)
    8.  `loss_ratio` (满期赔付率)
    9.  `expense_ratio` (费用率)
    10. `variable_cost_ratio` (变动成本率)
    11. `avg_commercial_index` (商业险平均自主系数) - *不再作为主KPI看板指标卡片，但定义保留*
3.  **衍生指标计算**：
    *   其他所有指标（如：`policy_count`, `expense_amount`, `premium_earned_ratio`, `marginal_contribution_ratio`, `marginal_contribution_amount`, `premium_share`）均为“衍生指标”。
    *   这些衍生指标的计算**总是**基于上述11项“原始核心指标”（其值已按规则1确定）以及必要的原始基础字段（如 `expense_amount_raw`）按其特定公式进行。
    *   “保单件数” (`policy_count`) 和 “满期保单件数” (`policy_count_earned`) 始终按公式计算，不直接从JSON读取（即使JSON中可能存在这些字段的预计算值）。
4.  **全局算术关系约束** (在KPI看板及所有计算中强制执行)：
    *   `变动成本率 = 费用率 + 满期赔付率` (此处的“费用率”和“满期赔付率”是按规则1和规则2确定的值)
    *   `边际贡献率 = 100% - 动成本率` (此处的“变动成本率”是按上述关系得到的值)
    *   `边贡额 = 满期保费 * (边际贡献率 / 100)` (此处的“满期保费”和“边际贡献率”是按规则1/2和上述关系得到的值)
5.  **单位统一**：计算过程中务必注意单位换算（万元 vs 元，百分比处理）。最终展示时也需明确单位，金额类指标默认显示整数（如 “1,234 万元”），件数取整，百分比默认保留一位小数（如 “12.3%”），特定均值（如单均保费、案均赔款）显示整数（元），自主系数保留三位小数。
6.  **空值处理**：如果某个业务类型在某个周期缺少必要的基础字段数据，则该业务类型不参与该周期的聚合计算。聚合结果中如果分子或分母为0或NaN，则结果显示为 "N/A" 或 0（根据指标特性）。
7.  **数据来源重要提示**：
    *   `total_loss_amount` (总赔款) 指的是 **已报告赔款**。基于此计算的 `loss_ratio` (满期赔付率) 的分子是已报告赔款，**需在报表或指标说明中注明此情况**。

---

## 一、指标分类与字段定义

**分类标签：** `保费类`, `保单类`, `赔付类`, `费用类`, `占比类`, `综合类`

| 分类  | 指标名称     | 字段名 (JSON中/衍生)           | 单位 | JSON提供类型 / 计算基础   | 计算逻辑 / 说明                                                                                                                                                                                                                                                           |
| :---- | :------- | :----------------------------- | :--- | :----------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **保费类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 保费类   | 跟单保费     | `premium_written`              | 万元 | **原始核心指标 (金额)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`premium_written` (YTD)。<br/>**聚合/当周模式**: SUM(所选范围的`premium_written`基础值)。                                                                                                                                       |
| 保费类   | 满期保费     | `premium_earned`               | 万元 | **原始核心指标 (金额)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`premium_earned` (YTD)。<br/>**聚合/当周模式**: SUM(所选范围的`premium_earned`基础值)。                                                                                                                                        |
| 保费类   | 单均保费     | `avg_premium_per_policy`       | 元   | **原始核心指标 (均值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`avg_premium_per_policy` (YTD预计算值)。若无效，则按 `(premium_written * 10000) / policy_count (衍生)` 计算。<br/>**聚合/当周模式**: `(SUM(premium_written基础值) * 10000) / SUM(衍生policy_count)`。                                                                |
| 保费类   | 保费满期率    | `premium_earned_ratio`         | %    | 衍生 (率值)             | **计算**: `(premium_earned / premium_written) * 100`。 其中 `premium_earned` 和 `premium_written` 的值遵循其作为“原始核心指标”的取值/计算规则。                                                                                                                                       |
| **保单类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 保单类   | 保单数量     | `policy_count`                 | 件   | **衍生 (数量, 始终计算)**             | **计算**: `(premium_written * 10000) / avg_premium_per_policy`。其中 `premium_written` 和 `avg_premium_per_policy` 的值遵循其作为“原始核心指标”的取值/计算规则。结果取整。 **此指标始终按公式计算，不从JSON直接读取。**                                                                                                               |
| 保单类   | 满期保单件数   | `policy_count_earned`          | 件   | **衍生 (数量, 始终计算)** | **计算**: `policy_count (衍生) * (premium_earned_ratio (衍生) / 100)`。结果取整。 **此指标始终按公式计算，不从JSON直接读取。** |
| **赔付类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 赔付类   | 总赔款      | `total_loss_amount`            | 万元 | **原始核心指标 (金额)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`total_loss_amount` (YTD)。<br/>**聚合/当周模式**: SUM(所选范围的`total_loss_amount`基础值)。                                                                                                                                |
| 赔付类   | 已报件数     | `claim_count`                  | 件   | **原始核心指标 (数量)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`claim_count` (YTD)。<br/>**聚合/当周模式**: SUM(所选范围的`claim_count`基础值)。结果取整。 *作为KPI看板指标卡之一。*                                                                                                                               |
| 赔付类   | 满期赔付率    | `loss_ratio`                   | %    | **原始核心指标 (率值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`loss_ratio` (YTD预计算值)。若无效，则按 `(total_loss_amount / premium_earned) * 100` 计算。<br/>**聚合/当周模式**: `(SUM(total_loss_amount基础值) / SUM(premium_earned基础值)) * 100`。<br/>**(需注明分子为已报告赔款)** |
| 赔付类   | 满期出险频度  | `claim_frequency`              | %    | **原始核心指标 (率值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`claim_frequency` (YTD预计算值)。若无效，则按 `(claim_count / policy_count_earned (衍生)) * 100` 计算。<br/>**聚合/当周模式**: `(SUM(claim_count基础值) / SUM(衍生policy_count_earned)) * 100`。                          |
| 赔付类   | 案均赔款     | `avg_loss_per_case`            | 元   | **原始核心指标 (均值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`avg_loss_per_case` (YTD预计算值)。若无效，则按 `(total_loss_amount * 10000) / claim_count` 计算。<br/>**聚合/当周模式**: `(SUM(total_loss_amount基础值) * 10000) / SUM(claim_count基础值)`。                                                      |
| **费用类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 费用类   | 原始费用额    | `expense_amount_raw`           | 万元 | 基础字段 (JSON提供, 金额) | **来源**: JSON中各业务类型提供的 `expense_amount_raw` (YTD)。<br/>**聚合/当周模式**: SUM(所选范围的`expense_amount_raw`基础值)。<br/>*此字段是计算“费用率”和“费用额”的基础。*                                                                                               |
| 费用类   | 费用额      | `expense_amount`               | 万元 | 衍生 (金额)             | **计算**: `premium_written * (expense_ratio / 100)`。其中 `premium_written` 和 `expense_ratio` 的值遵循其作为“原始核心指标”的取值/计算规则。                                                                                                                                  |
| 费用类   | 费用率      | `expense_ratio`                | %    | **原始核心指标 (率值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`expense_ratio` (YTD预计算值)。若无效，则按 `(expense_amount_raw / premium_written) * 100` 计算。<br/>**聚合/当周模式**: `(SUM(expense_amount_raw基础值) / SUM(premium_written基础值)) * 100`。                                   |
| **占比类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 占比类   | 保费占比     | `premium_share`                | %    | 衍生 (占比)             | **计算**: `premium_written (当前所选范围合计值) / 总计premium_written (全量数据中该周期的 totals_for_period.total_premium_written_overall) * 100`。                                                                                                  |
| **综合类** |         |                                |      |                         |                                                                                                                                                                                                                                                                       |
| 综合类   | 变动成本率    | `variable_cost_ratio`          | %    | **原始核心指标 (率值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`variable_cost_ratio` (YTD预计算值)。若无效，则按 `expense_ratio + loss_ratio` 计算。<br/>**聚合/当周模式**: `expense_ratio (聚合重算) + loss_ratio (聚合重算)`。<br/>**全局约束**: 此值始终等于 `费用率 + 满期赔付率` (相应层级的计算结果)。 |
| 综合类   | 商业险平均自主系数 | `avg_commercial_index`     | -    | **原始核心指标 (数值)**    | **单选业务类型（累计模式）**: 直接使用JSON中该业务类型的`avg_commercial_index` (YTD)。<br/>**聚合（多选或全部业务类型）/当周模式**: 不适用，显示为“-”。*不再作为主KPI看板指标卡。*                                                                                                                                        |
| 综合类   | 边际贡献率    | `marginal_contribution_ratio`  | %    | 衍生 (率值)             | **计算**: `100% - variable_cost_ratio`。其中 `variable_cost_ratio` 的值遵循其作为“原始核心指标”的取值/计算规则并满足全局约束。                                                                                                                                              |
| 综合类   | 边贡额      | `marginal_contribution_amount` | 万元 | 衍生 (金额)             | **计算**: `premium_earned * (marginal_contribution_ratio / 100)`。其中 `premium_earned` 的值遵循其作为“原始核心指标”的取值/计算规则，`marginal_contribution_ratio` 为上述衍生计算结果。                                                                                          |

**备注：**
*   “增量XX”指标在KPI看板上主要体现为与“对比周期”的“绝对值变化”和“百分比/百分点变化”。这些对比值的计算基于“当前期”和“对比期”各自的指标值（这些指标值本身遵循上述规则确定）。对比标签会明确指出是“对比 XXXX周期”或“对比 上一期”。
*   对于“全部业务类型”的场景，金额和数量类原始核心指标通过加总所有独立业务线得出；比率和均值类原始核心指标则基于这些加总后的基础值重新计算。“保单件数”和“满期保单件数”对所有独立业务线分别计算后求和。

---

## 二、JSON 数据结构 (`public/data/insurance_data_v4.json`)
(保持不变)

---

## 三、高亮风险规则
(保持不变)

---

## 四、前端开发核心关注点
1.  **数据处理逻辑的准确实现**：
    *   严格区分“累计值分析”与“当周发生额分析”模式。
    *   在“累计值分析”模式下，正确识别“单选业务类型”场景，优先使用JSON为该类型提供的相关原始核心指标的YTD预计算值（`policy_count`和`policy_count_earned`除外，它们始终计算）。
    *   在“多选业务类型”、“全部业务类型”或任何“当周发生额分析”场景下，确保所有原始核心指标（特别是率和均值）基于聚合基础字段重新计算。`policy_count`和`policy_count_earned`则为各业务线计算后求和。
    *   确保所有“衍生指标”基于已确定的“原始核心指标”值进行计算。
    *   强制执行 `变动成本率 = 费用率 + 满期赔付率` 和 `边际贡献率 = 100% - 变动成本率` 的全局算术关系。
2.  **单位换算与格式化**：确保金额单位（万元与元）、百分比、件数的正确处理和显示。
3.  **分子分母匹配**：计算各种比率时，确保分子和分母的业务含义及数据来源正确匹配（特别是聚合计算时）。
4.  **“已报告赔款”的透明化**：对于使用“已报告赔款”计算的“满期赔付率”，务必在界面上清晰告知用户。
5.  **“商业险平均自主系数”的处理**：在聚合视图（多选业务类型或“全部业务类型”）或“当周发生额”模式下，应不显示或标记为“不适用”。
6.  **对比计算**：正确关联当前期与对比期数据，并准确计算对比值及变动幅度。KPI卡片对比标签明确化。
7.  **空值与除零处理**：妥善处理计算中可能出现的空值、NaN或分母为零的情况，避免程序错误，并给出友好提示。
8.  **性能考量**：对于大量数据的计算和渲染，考虑前端性能优化。
9.  **图表数据源**：更新各图表的数据源，使其正确反映当前分析模式和筛选条件下的数据，这些数据也应遵循上述核心计算逻辑。
10. **AI智能摘要**：确保传递给AI模型的数据结构与模型期望一致，并且这些数据也是基于上述核心计算逻辑得出的。
