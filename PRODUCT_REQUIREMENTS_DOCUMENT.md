
# 产品需求文档 (PRD) - 车险经营分析周报

**版本**: 1.4
**最后更新日期**: 2024-05-24
**负责人**: AI项目大师

## 1. 引言

### 1.1. 目的
本文档旨在明确“车险经营分析周报”应用（以下简称“本应用”）的产品需求，包括产品目标、核心功能、用户场景、设计规范及非功能性需求。本文档将作为项目团队进行设计、开发、测试和验收的主要依据。

### 1.2. 范围
本应用的核心目标是为车险业务分析人员和管理层提供一个直观、高效的数据可视化分析平台，帮助他们快速洞察业务表现、识别风险与机遇，并支持数据驱动的决策。主要范围包括关键绩效指标（KPI）的展示、多维度趋势分析、业务类型对比、数据明细查询以及基于AI的智能摘要和图表解读。

### 1.3. 目标受众
*   **车险业务分析师**：需要深入钻取数据，发现业务问题和增长点。
*   **车险部门经理/管理层**：需要快速了解整体业务状况，监控核心KPI，并获取决策支持信息。
*   **数据团队成员**：需要理解数据来源、计算逻辑和展示方式，以支持系统维护和迭代。

### 1.4. 术语定义
*   **YTD (Year To Date)**: 本年迄今累计。
*   **PoP (Period over Period)**: 环比，本期与上一期（通常是上一周）的比较。
*   **YoY (Year over Year)**: 同比，本期与去年同期的比较。
*   **KPI (Key Performance Indicator)**: 关键绩效指标。
*   **业务类型**: 指不同的车险产品线或分类，例如“非营业客车新车”、“营业货车”等。
*   **数据周期**: 数据统计的时间单位，本应用中指“周”。
*   **累计值分析**: 基于YTD数据的分析。
*   **当周发生额分析**: 基于当前周期相较于上一周期的增量数据进行的分析（也称为“环比数据分析”）。
*   **VCR (Variable Cost Ratio)**: 变动成本率。
*   详细的指标定义和计算逻辑请参考项目根目录下的 `FIELD_DICTIONARY_V4.md` 文件。

## 2. 产品概述

### 2.1. 产品愿景
打造一款智能、高效、易用的车险经营分析工具，赋能业务团队，通过数据洞察驱动业绩增长和风险管控。

### 2.2. 产品目标
*   **提升分析效率**：通过自动化的数据处理和可视化展示，显著减少人工制作周报和分析数据的时间。
*   **增强数据洞察**：提供多维度、交互式的分析功能，帮助用户从不同角度理解业务表现。
*   **辅助决策制定**：通过清晰的KPI监控、风险预警和AI智能摘要，为管理层提供及时、准确的决策支持。
*   **统一数据口径**：确保核心指标的计算逻辑和数据来源统一，提升团队沟通效率。

### 2.3. 核心价值
*   **实时性与准确性**：基于最新的周度数据，提供准确的业务指标。
*   **可视化与直观性**：通过丰富的图表和卡片，使复杂数据易于理解。
*   **灵活性与可配置性**：支持分析模式切换、业务类型筛选、数据周期选择，满足不同分析需求。
*   **智能化辅助**：利用AI生成业务摘要和图表解读，提炼关键信息，发现潜在问题。

## 3. 用户画像与场景

### 3.1. 用户画像
*   **李明 (业务分析师)**: 30岁，数据分析经验3年。日常负责监控各业务线表现，撰写周报，向管理层汇报。痛点：手动处理数据耗时，难以快速响应临时的分析需求。期望：一个能快速生成标准化报表，并支持灵活数据钻取的工具。
*   **王总 (部门经理)**: 45岁，车险行业经验15年。日常需要快速了解整体业绩、主要风险点和下属团队表现。痛点：周报信息滞后，难以快速把握动态变化。期望：一个能实时展示核心KPI，并提供高层摘要和预警的仪表盘。

### 3.2. 核心使用场景
*   **场景一：日常业务监控与周报生成**
    *   李明打开应用，选择最新的数据周期，查看KPI看板，了解各项核心指标的达成情况及环比、同比变化。
    *   他可根据需要筛选特定的一个或多个业务类型进行分析。
    *   他切换到“趋势分析”视图，选择关键指标（如跟单保费、满期赔付率），查看最近12周的走势。图表颜色会根据变动成本率动态变化。
    *   他使用“对比气泡图”，自定义X轴、Y轴和气泡大小对应的指标，比较不同业务类型在所选维度上的表现。气泡颜色同样根据VCR动态变化，且无图例。
    *   他使用“水平条形图排名”，选择指标对各业务类型进行排名，条形颜色根据VCR动态变化。数据标签根据指标类型格式化（百分比显示1位小数，金额类按规则显示万或元整数，件数显示整数）。
    *   他查看AI生成的总体业务摘要，快速了解本周亮点和风险。
    *   他对每个图表单独生成AI分析，获取更具体的解读。
    *   他使用“数据表”视图，核对特定业务类型的原始和聚合数据。
    *   最后，他导出当前视图下的数据（或截图），作为周报素材。
*   **场景二：管理层快速概览**
    *   王总在晨会前打开应用，默认进入KPI看板，迅速浏览关键指标的达成状态和风险高亮。
    *   他重点关注AI生成的总体业务摘要，了解核心结论。
    *   如果某个KPI出现异常（如变动成本率过高），他可能会点击查看该指标的趋势图或排名图，简单了解情况。
*   **场景三：专项问题分析**
    *   管理层发现“非营业客车新车”业务线的费用率近期持续上升。
    *   李明接到指示，打开应用，选择“非营业客车新车”业务类型，切换到“当周发生额分析”模式。
    *   他查看该业务线费用率的趋势图，并点击生成该图表的AI分析，尝试找出可能的原因。
    *   他可能会进一步查看数据表，对比其费用额和跟单保费的当周发生额变化。

## 4. 核心功能需求

### 4.1. KPI 看板 (F-KPI)
*   **F-KPI-001**: 以卡片形式展示预设的核心绩效指标 (16个，布局为4列4行)。
    *   **第一列 (从上到下)**: 边际贡献率, 变动成本率, 费用率, 满期赔付率
    *   **第二列 (从上到下)**: 边贡额, 保费, 费用, 赔款
    *   **第三列 (从上到下)**: 满期保费, 保费满期率, 单均保费, 保单件数
    *   **第四列 (从上到下)**: 保费占比, 自主系数, 满期出险率, 案均赔款
*   **F-KPI-002**: 每个KPI卡片应清晰显示指标名称、当前值、环比变化（百分比和绝对值）、同比变化（百分比和绝对值）。
*   **F-KPI-003**: KPI数值应根据预设的风险阈值进行高亮显示（例如，红色表示高风险，橙色表示关注，特定指标卡片边框高亮）。
*   **F-KPI-004**: KPI卡片应包含一个简洁的图标，直观表示指标含义。
*   **F-KPI-005**: KPI卡片的尺寸（高度和宽度）应在视觉上保持一致性 (例如，通过设置最小高度 `min-h-[180px]`)。
*   **F-KPI-006**: 对于“满期赔付率”等特殊指标，应有明确提示其计算口径（如“基于已报告赔款”）。
*   **F-KPI-007**: “自主系数”在多选业务类型或合计时，应显示为“N/A”或不适用。

### 4.2. 趋势分析 (F-TREND)
*   **F-TREND-001**: 以折线图形式可视化所选指标在连续数据周期（默认最近12周，可追溯至最早有数据的周期）内的趋势。
*   **F-TREND-002**: 用户可从预设的指标列表中选择要分析的趋势指标（例如：跟单保费、总赔款、保单数量、满期赔付率、费用率、变动成本率等）。
*   **F-TREND-003**: 图表应清晰展示X轴（数据周期）和Y轴（指标值）。Y轴应根据指标类型（金额、百分比、件数）进行适配和格式化。
*   **F-TREND-004**: 鼠标悬浮在图表上时，应显示该数据点的详细信息 (Tooltip)。
*   **F-TREND-005**: 支持多条业务线（或合计线）在同一图表中对比展示（当业务类型筛选器支持多选或全选时）。
*   **F-TREND-006**: 图表应包含图例，清晰标识每条线的含义。
*   **F-TREND-007**: 线条颜色根据其对应业务线（或合计）在该周期的变动成本率动态变化：VCR >= 92% 为红色系，88% <= VCR < 92% 为蓝色系，VCR < 88% 为绿色系。颜色深浅根据VCR值在区间内动态调整（例如，VCR越小绿色越深，VCR越大红色越深）。

### 4.3. 对比气泡图 (F-BUBBLE)
*   **F-BUBBLE-001**: 使用气泡图比较不同保险类型（或筛选后的业务类型）的多个指标。
*   **F-BUBBLE-002**: 用户可从预设的指标列表（源自指标字典中适合的字段）中分别为X轴、Y轴和气泡大小选择指标。
*   **F-BUBBLE-003**: 每个气泡代表一个独立的业务类型。
*   **F-BUBBLE-004**: 鼠标悬浮在气泡上时，应显示该业务类型的名称及X、Y、Z轴的详细数值和单位，以及VCR值。
*   **F-BUBBLE-005**: 移除图表图例。气泡颜色作为直接信息传递。
*   **F-BUBBLE-006**: X轴和Y轴的刻度应动态适应数据范围，并进行合适的单位格式化。
*   **F-BUBBLE-007**: 气泡颜色根据其对应业务线在该周期的变动成本率动态变化：VCR >= 92% 为红色系，88% <= VCR < 92% 为蓝色系，VCR < 88% 为绿色系。颜色深浅根据VCR值在区间内动态调整。

### 4.4. 水平条形图排名 (F-RANK)
*   **F-RANK-001**: 使用水平条形图，根据用户选择的单个指标对各业务类型进行排名。图表应有足够的显示高度（例如 `h-[450px]`）。Y轴清晰显示业务类型名称。
*   **F-RANK-002**: 用户可从预设的指标列表（包含KPI看板核心指标，排除不适宜排名的）中选择要排名的指标。
*   **F-RANK-003**: 条形图按指标值降序排列。
*   **F-RANK-004**: 每个条形代表一个独立的业务类型，并显示其名称和指标值。
    *   **数据标签**: 条形顶端的数据标签应完整显示，并根据指标类型格式化：
        *   百分比类：显示为1位小数，带百分号 (例如 "67.9%")。
        *   金额类(万元)：显示为整数，带“万”字 (例如 "123 万")。
        *   单均保费(元)：显示为整数，带“元”字 (例如 "2013 元")。
        *   案均赔款(元)：显示为整数，带“元”字 (例如 "5676 元")。
        *   件数类：显示为整数，带“件”字 (例如 "123 件")。
    *   标签应完整显示，已调整图表右边距。
*   **F-RANK-005**: X轴表示指标值，刻度应根据所选指标类型动态适配易读单位（例如，金额(万元)显示为 "X万", "X千万", "X亿"；金额(元)显示为 "X元", "X千元", "X百万元"；百分比显示为 "X%"；件数显示为整数）。
*   **F-RANK-006**: 条形颜色根据其对应业务线在该周期的变动成本率动态变化：VCR >= 92% 为红色系，88% <= VCR < 92% 为蓝色系，VCR < 88% 为绿色系。颜色深浅根据VCR值在区间内动态调整。

### 4.5. 数据表显示 (F-TABLE)
*   **F-TABLE-001**: 以表格形式显示每个业务线（或合计行）的各项核心指标的原始值和计算值。
*   **F-TABLE-002**: 表格列应包括业务线名称、跟单保费、总赔款、保单数量、满期赔付率、费用率等核心指标。
*   **F-TABLE-003**: 当分析模式为“当周发生额分析”（环比数据）时，表格应额外显示各指标的环比变化百分比（或百分点）。
*   **F-TABLE-004**: 数值应根据其类型（金额、百分比、件数）进行格式化。
*   **F-TABLE-005**: 环比变化应使用箭头（上升/下降/持平）和颜色（根据指标业务含义决定升红降绿或反之）进行可视化提示。

### 4.6. 全局筛选与控制
*   **F-CTRL-001: 分析模式切换**
    *   允许用户在“累计数据”（YTD）和“环比数据”（当周发生额）两种分析模式间切换。
    *   切换后，所有看板、图表和数据表的数据源均随之更新。
*   **F-CTRL-002: 数据周期选择**
    *   提供下拉菜单，允许用户选择要分析的数据周期（周）。
    *   周期列表按时间倒序排列。
    *   选择后，所有看板、图表和数据表的数据源均随之更新。
*   **F-CTRL-003: 业务类型筛选**
    *   提供多选下拉菜单，允许用户选择一个或多个业务类型进行分析。
    *   支持“全选/全不选”、“反选”功能。
    *   如果未选择任何业务类型，或选择了“全选”，则默认分析所有独立业务类型的合计数据。
    *   如果选择单个业务类型，则仅分析该业务类型。
    *   如果选择多个业务类型，则分析这些选定业务类型的合计数据（标记为“自定义合计”）。
    *   选择后，所有看板、图表和数据表的数据源均随之更新。
*   **F-CTRL-004: 数据导出**
    *   提供“导出”按钮，允许用户将当前“数据表显示”视图中的数据导出为CSV文件。
    *   导出的文件名应包含当前周期、分析模式和所选业务类型等信息。
*   **F-CTRL-005: 视图切换**
    *   提供导航区域（如标签页或按钮组），允许用户在“KPI看板”、“趋势图”、“气泡图”、“排名图”、“数据表”等不同视图间切换。

### 4.7. AI 智能分析
*   **F-AI-001: 总体业务摘要**
    *   提供“AI摘要”按钮，点击后，AI模型根据当前筛选条件（周期、业务类型、分析模式）下的KPI数据和主要业务线表现，生成一段中文的业务绩效亮点、潜在风险和初步洞察的摘要。
    *   摘要应显示在页面显著位置。
    *   生成过程中应有加载提示。
*   **F-AI-002: 图表AI分析**
    *   在“趋势分析”、“对比气泡图”、“水平条形图排名”视图下方，分别提供独立的“生成AI分析”按钮。
    *   点击后，AI模型根据当前图表显示的数据和相关上下文（如所选指标、分析模式、VCR颜色规则），生成一段针对该图表的中文解读，包括关键趋势、异常点、集群特征、主要排名等。
    *   分析结果显示在对应图表的下方。
    *   生成过程中应有加载提示。
    *   如果图表无数据显示，则此按钮应禁用。

## 5. 非功能性需求

### 5.1. 性能
*   **NF-PERF-001**: 页面加载时间：首次加载应在3秒内完成主要框架渲染。
*   **NF-PERF-002**: 数据切换与筛选响应：切换数据周期、分析模式、业务类型或图表指标后，数据和图表更新应在2秒内完成。
*   **NF-PERF-003**: AI摘要生成：AI分析结果的返回时间应尽可能控制在5-10秒内，并提供清晰的加载反馈。

### 5.2. 易用性
*   **NF-USAB-001**: 界面直观易懂，用户无需培训即可理解主要功能和操作流程。
*   **NF-USAB-002**: 交互清晰明确，重要的操作（如模式切换、筛选）应有即时反馈。
*   **NF-USAB-003**: 错误提示友好，当发生错误或无数据时，应给出明确的提示信息。
*   **NF-USAB-004**: 应用应支持主流现代浏览器（Chrome, Edge, Firefox, Safari 最新版本）。
*   **NF-USAB-005**: 应用界面应具备响应式设计，在常见桌面分辨率下有良好显示效果。

### 5.3. 可靠性
*   **NF-REL-001**: 数据计算准确无误，严格遵循 `FIELD_DICTIONARY_V4.md` 中定义的计算逻辑。
*   **NF-REL-002**: 系统在常规操作下应稳定运行，避免出现崩溃或无响应的情况。
*   **NF-REL-003**: 对于无效输入或异常数据（如分母为0），应进行妥善处理，避免程序中断，并显示友好提示（如 "N/A"）。

### 5.4. 可维护性
*   **NF-MAIN-001**: 代码结构清晰，模块化程度高，易于理解和修改。
*   **NF-MAIN-002**: 遵循项目技术栈（NextJS, React, ShadCN UI, Tailwind, Genkit）的最佳实践。
*   **NF-MAIN-003**: 核心数据处理逻辑应集中管理，易于调试和迭代。
*   **NF-MAIN-004**: 配置文件（如颜色主题、AI模型配置）应易于修改。

### 5.5. 安全性
*   **NF-SEC-001**: （针对本地应用）主要关注前端代码安全，避免常见的XSS等注入风险（尽管在本应用场景下风险较低）。
*   **NF-SEC-002**: （若未来扩展至网络服务）AI Genkit调用应配置适当的API密钥管理和安全措施。

## 6. 设计与用户体验

### 6.1. 风格指南
*   **主色调**: 深蓝色 (#2E3192)，传达金融分析中的信任和稳定性。
*   **背景色**: 非常浅的蓝色 (#F0F4FF)，提供干净而平静的背景。
*   **强调色**: 紫色 (#9C27B0)，用于引起对重要交互元素和数据点的注意。
*   **动态VCR颜色**:
    *   优秀 (VCR < 88%): 绿色系，VCR越小颜色越深。 (例如: `hsl(var(--chart-success-green))` 的不同亮度变体)
    *   健康 (88% <= VCR < 92%): 蓝色系，VCR越接近88%颜色越深。(例如: `hsl(var(--chart-warning-blue))` 的不同亮度变体)
    *   危险 (VCR >= 92%): 红色系，VCR越大颜色越深。(例如: `hsl(var(--chart-destructive-red))` 的不同亮度变体)
*   **字体**:
    *   标题字体: 'Space Grotesk' (sans-serif)，现代科技感。
    *   正文字体: 'Inter' (sans-serif)，清晰易读。
*   **图标**: 使用来自 `lucide-react` 的简单几何图标。
*   **布局**: 干净、基于网格的布局，有效呈现数据。
*   **组件风格**: 优先使用 ShadCN UI 组件，保持圆角、阴影等现代专业感。
*   详细的颜色变量定义见 `src/app/globals.css`。

### 6.2. 交互
*   **F-UX-001**: 筛选和排序数据时，使用微妙的过渡效果以改善用户体验。
*   **F-UX-002**: 按钮和可交互元素在鼠标悬浮和点击时应有明确的视觉反馈。
*   **F-UX-003**: 加载状态应通过加载指示器（如骨架屏、旋转图标）清晰传达。

## 7. 数据需求

### 7.1. 数据源
*   主要数据源为项目 `public/data/insurance_data_v4.json` 文件。
*   此文件包含按周期组织的车险业务YTD数据。

### 7.2. 数据结构与计算逻辑
*   详细的数据结构、字段定义、基础计算公式、聚合逻辑、同比环比计算规则，请严格参照项目根目录下的 `FIELD_DICTIONARY_V4.md` 文档。此文档是数据准确性的核心依据。

### 7.3. 数据更新频率
*   目前假设 `insurance_data_v4.json` 文件会按周进行更新。应用本身不负责数据的采集和ETL过程，仅消费已提供的数据文件。

## 8. 未来展望 (可选)
*   **用户自定义KPI看板**：允许用户选择和排列自己关心的KPI。
*   **更细粒度的下钻分析**：例如，从业务类型下钻到具体险种。
*   **预测功能**：基于历史数据进行简单的趋势预测。
*   **更高级的AI洞察**：例如，自动识别指标间的复杂关联，或提供更具体的优化建议。
*   **权限管理**：如果部署为多用户系统，需要考虑用户权限和数据隔离。
*   **数据导入/连接**：支持从数据库或其他数据源动态加载数据。

## 9. 附录
*   **《字段字典与计算逻辑 (V4.0)》**: 详见项目根目录 `FIELD_DICTIONARY_V4.md` 文件。
*   **《问题与解决日志》**: 详见项目根目录 `ISSUES_LOG.md` 文件。

---
**文档审批**

| 角色       | 姓名 | 签名 | 日期       |
| :--------- | :--- | :--- | :--------- |
| 产品负责人 |      |      |            |
| 开发负责人 |      |      |            |
| 测试负责人 |      |      |            |

---
**修订历史**

| 版本 | 日期       | 修订人     | 修订说明                               |
| :--- | :--------- | :------- | :------------------------------------- |
| 1.0  | 2024-05-21 | AI项目大师 | 初始版本，根据当前已实现和规划功能创建。 |
| 1.1  | 2024-05-23 | AI项目大师 | 更新图表动态颜色规则、气泡图指标筛选、AI分析上下文、添加问题日志和README引用。 |
| 1.2  | 2024-05-24 | AI项目大师 | 更新KPI看板布局为4x4网格。 |
| 1.3  | 2024-05-24 | AI项目大师 | 优化排名图：颜色与VCR挂钩、增加高度、统一标签格式（初版）、扩展指标；更新气泡图移除图例。 |
| 1.4  | 2024-05-24 | AI项目大师 | 再次优化排名图：细化数据标签和X轴刻度格式（百分比1位小数，金额类区分万/元整数），确保Y轴业务名称显示。 |
