
# 产品需求文档 (PRD) - 车险经营分析周报

**版本**: 2.7
**最后更新日期**: 2024-05-28
**负责人**: AI项目大师

## 1. 引言

### 1.1. 目的
本文档旨在明确“车险经营分析周报”应用（以下简称“本应用”）的产品需求，包括产品目标、核心功能、用户场景、设计规范及非功能性需求。本文档将作为项目团队进行设计、开发、测试和验收的主要依据。

### 1.2. 范围
本应用的核心目标是为车险业务分析人员和管理层提供一个直观、高效的数据可视化分析平台，帮助他们快速洞察业务表现、识别风险与机遇，并支持数据驱动的决策。主要范围包括关键绩效指标（KPI）的展示、多维度趋势分析、业务类型对比、数据明细查询以及基于AI的智能摘要和图表解读。

### 1.3. 目标受众
*   车险业务分析师：需要深入钻取数据，发现业务问题和增长点。
*   车险部门经理/管理层：需要快速了解整体业务状况，监控核心KPI，并获取决策支持信息。
*   数据团队成员：需要理解数据来源、计算逻辑和展示方式，以支持系统维护和迭代。

### 1.4. 术语定义
*   **YTD (Year To Date)**: 本年迄今累计。
*   **PoP (Period over Period)**: 环比，本期与上一期（通常是上一周）的比较。
    *   **KPI看板/数据表中的对比变化值逻辑**：基于`FIELD_DICTIONARY_V4.md`中定义的“当周发生额分析模式”进行计算（若分析模式为当周发生额），或基于累计值计算（若分析模式为累计）。费率等指标是基于基础字段的差额或累计值重新计算的。对比标签会根据用户选择的对比周期或默认的上一周期动态显示为“对比 [周期名称]”（例如 “对比 2025年第22周” 或 “对比 上一期”）。
    *   **趋势图中的环比数据 (analysisMode='periodOverPeriod')**：对于所有指标（包括率值和绝对值），图表上每个点的值代表 `当前期对应指标的YTD值 - 上一期对应指标的YTD值`。
*   **YoY (Year over Year)**: 同比，本期与去年同期的比较 (当前版本KPI看板不直接展示同比，依赖用户选择对比周期实现)。
*   **自定义对比期**: 用户可从周期列表中选择任一周期作为当前周期的对比基准。
*   **KPI (Key Performance Indicator)**: 关键绩效指标。
*   **业务类型**: 指不同的车险产品线或分类，例如“非营业客车新车”、“营业货车”等。图表和数据表中显示的业务类型名称会使用预定义的缩写以提高可读性，数据源中的原始名称保持不变。
*   **数据周期**: 数据统计的时间单位，本应用中指“周”。
*   **累计值分析**: 基于YTD数据的分析。KPI看板默认显示最新一周的累计数据。
*   **当周发生额分析 (analysisMode='periodOverPeriod')**:
    *   **KPI看板/数据表**：基于当前周期相较于“对比周期”的增量数据进行的分析，费率等是基于基础字段差额重新计算的。
    *   **趋势图**：图表上每个点的值代表 `当前期对应指标的YTD值 - 上一期对应指标的YTD值`。
*   **变动成本率 (Variable Cost Ratio)**: 原VCR，指满期赔付率与费用率之和。
*   **pp (percentage points)**: 百分点，用于描述两个百分比之间的算术差。
*   **数据源 (Data Source)**: 指应用获取业务数据的来源，可以是本地JSON文件或外部数据库。
*   详细的指标定义和计算逻辑请参考项目根目录下的 `FIELD_DICTIONARY_V4.md` 文件。

## 2. 产品概述

### 2.1. 产品愿景
打造一款智能、高效、易用的车险经营分析工具，赋能业务团队，通过数据洞察驱动业绩增长和风险管控。

### 2.2. 产品目标
*   提升分析效率：通过自动化的数据处理和可视化展示，显著减少人工制作周报和分析数据的时间。
*   增强数据洞察：提供多维度、交互式的分析功能，帮助用户从不同角度理解业务表现。
*   辅助决策制定：通过清晰的KPI监控、风险预警和AI智能摘要，为管理层提供及时、准确的决策支持。
*   统一数据口径：确保核心指标的计算逻辑和数据来源统一，提升团队沟通效率。
*   灵活数据接入: 支持从不同数据源（如本地文件、数据库）加载数据，并支持自定义对比周期。

### 2.3. 核心价值
*   实时性与准确性：基于最新的周度数据，提供准确的业务指标。
*   可视化与直观性：通过丰富的图表和卡片，使复杂数据易于理解。图表中业务类型显示名称会使用缩写以增强可读性。
*   灵活性与可配置性：支持分析模式切换、业务类型筛选、数据周期选择、自定义对比周期选择、数据源切换，满足不同分析需求。
*   智能化辅助：利用AI生成业务摘要和图表解读，提炼关键信息，发现潜在问题。

## 3. 用户画像与场景

### 3.1. 用户画像
*   李明 (业务分析师): 30岁，数据分析经验3年。日常负责监控各业务线表现，撰写周报，向管理层汇报。痛点：手动处理数据耗时，难以快速响应临时的分析需求。期望：一个能快速生成标准化报表，并支持灵活数据钻取的工具。
*   王总 (部门经理): 45岁，车险行业经验15年。日常需要快速了解整体业绩、主要风险点和下属团队表现。痛点：周报信息滞后，难以快速把握动态变化。期望：一个能实时展示核心KPI，并提供高层摘要和预警的仪表盘。
*   张工 (IT/数据运维): 35岁，负责系统维护和数据源管理。期望：应用能灵活配置数据源，便于未来从测试数据迁移到生产数据库。

### 3.2. 核心使用场景
*   场景一：日常业务监控与周报生成
    *   李明打开应用，默认看到最新一周的累计数据KPI看板。KPI看板下方会显示当前所选周期与对比周期的信息。
    *   他可选择数据源（默认为JSON，未来可切换至数据库）。
    *   他选择最新的数据周期作为“当前周期”，并可选择任一周作为“对比周期”（默认为智能对比上一周期）。查看KPI看板，了解各项核心指标的达成情况及与所选对比周期的变化（同时显示绝对值变化和百分比/百分点变化）。
    *   他可根据需要筛选特定的一个或多个业务类型进行分析。
    *   他切换到“趋势分析”视图，选择关键指标（如跟单保费、满期赔付率），查看最近12周的走势。图表会根据指标类型智能切换为折线图（率值）或柱状图（数值），图表颜色会根据变动成本率动态变化，业务类型名称会显示为缩写。当选择“环比数据”模式时，图表会显示YTD指标值的逐期差额。
    *   他使用“对比气泡图”，自定义X轴、Y轴和气泡大小对应的指标，比较不同业务类型（显示为缩写）在所选维度上的表现。气泡颜色同样根据变动成本率动态变化，且无图例。
    *   他使用“水平条形图排名”，选择指标对各业务类型（显示为缩写）进行排名，条形颜色根据变动成本率动态变化。数据标签根据全局格式化规则显示。Y轴清晰显示业务类型缩写名称。
    *   他使用新增的“占比图”，选择一个绝对值类指标（如跟单保费），查看各业务类型（显示为缩写）在该指标上贡献的百分比。饼图扇区颜色根据变动成本率动态变化，扇区本身不显示数据标签，图例按占比降序、三列（每列最多5项）方式显示业务类型和占比。
    *   他使用新增的“帕累托图”，选择一个绝对值类指标，查看按贡献降序排列的业务类型（显示为缩写）及其累计贡献百分比（80/20法则）。柱状图颜色根据变动成本率动态变化，X轴业务类型标签横向显示。
    *   他查看AI生成的总体业务摘要，获取结构化的业务亮点和风险分析（摘要会考虑当前选择的对比周期，内容会使用Markdown加粗突出重点）。
    *   他对每个图表单独生成AI分析（功能按钮和内容区域统一位于图表下方），获取针对当前图表数据和筛选条件的、结构化的解读（内容会使用Markdown加粗突出重点，并解释变动成本率颜色背后的业务含义）。
    *   他使用“数据表”视图，核对特定业务类型（显示为缩写）的原始和聚合数据，数值按全局格式化规则显示。当选择了自定义对比周期时，表格中会显示与该对比周期的变化。
    *   最后，他使用“导出”功能，将当前数据表（已应用筛选、分析模式和对比周期）导出为CSV文件，作为周报素材。
*   场景二：管理层快速概览
    *   王总在晨会前打开应用，默认进入KPI看板（最新一周累计数据），迅速浏览关键指标的达成状态和风险高亮。看板下方清晰标明了对比的周期。
    *   他重点关注AI生成的总体业务摘要，了解核心结论（重点内容已加粗）。
    *   如果某个KPI出现异常，他可能会点击查看该指标的趋势图或排名图，简单了解情况。
*   场景三：专项问题分析 (特定周期对比)
    *   管理层发现“非营业客车新车”业务线的费用率近期持续上升，并想对比W20和W22的数据。
    *   李明接到指示，打开应用，选择“非营业客车新车”业务类型，将“当前周期”设为W22，将“对比周期”设为W20。他可以先查看“累计数据”模式下的KPI和趋势，然后切换到“当周发生额分析”模式。
    *   在“当周发生额分析”模式下，他查看该业务线费用率的趋势图（此时图表显示的是YTD费用率的逐期差额），并点击生成该图表的AI分析，尝试找出可能的原因。
    *   他可能会进一步查看数据表，对比其费用额和跟单保费在W22相对于W20的当周发生额变化。
*   场景四：数据源切换与测试 (针对IT/数据运维)
    *   张工在系统维护或测试阶段，需要验证数据库数据与JSON文件数据的一致性。
    *   他使用应用头部的“数据源切换”功能，在“JSON文件”和“PostgreSQL数据库”之间切换。
    *   切换后，他观察KPI看板、图表和数据表是否正确加载并显示对应数据源的数据。
    *   如果选择数据库但连接失败或数据为空，系统应给出友好提示。

## 4. 核心功能需求

### 4.1. KPI 看板 (F-KPI)
*   F-KPI-001: 以卡片形式展示预设的核心绩效指标 (16个，布局为4列4行)。默认展示最新一周的累计数据。卡片最小高度调整为 `min-h-[170px]` 以优化视觉。
    *   第一列 (从上到下): 边际贡献率, 变动成本率, 费用率, 满期赔付率
    *   第二列 (从上到下): 边贡额, 保费, 费用, 赔款
    *   第三列 (从上到下): 满期保费, 保费满期率, 单均保费, 保单件数
    *   第四列 (从上到下): 保费占比, 满期出险率, 案均赔款, 已报件数
*   F-KPI-002: 每个KPI卡片应清晰显示指标名称、当前值（按全局格式化规则显示，不带单位，百分比带%）。
    *   卡片右上角：对于金额、件数、元等非率值/占比类指标，显示其单位（如“万元”、“元”、“件”）；对于率值/占比类指标，显示一个简洁的、与指标内在本质相关的图标（如：变动成本率用Zap，费用率用Percent，满期赔付率用ShieldAlert，保费占比用PieChart，满期出险率用Activity，边际贡献率和保费满期率用Ratio）。
    *   显示与**对比周期**的变化：同时显示**绝对值变化**和**百分比/百分点变化**。此对比变化不再包含周期标签。
    *   **对比周期信息统一显示**：在KPI卡片网格下方，统一显示当前数据周期与对比周期的信息，例如：“当前数据周期：2025年第23周 | 对比数据周期：2025年第22周”。如果用户未选择特定对比周期，则显示为“当前数据周期：2025年第23周 | 对比上一期 (2025年第22周)”。
    *   绝对值变化按全局格式化规则显示（不带单位），百分比变化按X.X%显示，百分点变化按X.X pp显示。
*   F-KPI-003: KPI数值应根据预设的风险阈值进行高亮显示（例如，红色表示高风险，橙色表示关注，特定指标卡片边框高亮）。
    *   “保费”指标的变化颜色指示：根据当前聚合数据的变动成本率动态确定。若变动成本率 >= 92%（危险区），保费增长显示为负向（红色）；若变动成本率 < 92%（健康/优秀区），保费增长显示为正向（绿色）。
*   F-KPI-004: (已调整为 F-KPI-002 右上角单位/图标显示)
*   F-KPI-005: KPI卡片的尺寸（高度和宽度）应在视觉上保持一致性 (例如，通过设置最小高度 `min-h-[170px]`)。
*   F-KPI-006: 对于“满期赔付率”等特殊指标，应有明确提示其计算口径（如“基于已报告赔款”）。
*   F-KPI-007: “商业险平均自主系数”不再作为主看板KPI，其位置由“已报件数”替代。自主系数本身定义和计算逻辑见`FIELD_DICTIONARY_V4.md`，可在其他分析视图（如图表指标选择、数据表）中使用，但聚合时显示“-”。

### 4.2. 趋势分析 (F-TREND)
*   F-TREND-001: 根据指标类型智能切换图表形式：率值类指标（如赔付率、费用率等）使用**折线图**，数值类指标（如保费金额、件数等）使用**柱状图**。可视化所选指标在连续数据周期（默认最近12周，可追溯至最早有数据的周期）内的趋势。业务类型名称以缩写形式显示。
    *   当分析模式为“累计数据”时，图表展示各周期的累计YTD值。
    *   当分析模式为“当周发生额分析”（环比数据）时，图表上每个点的值代表 `当前期对应指标的YTD值 - 上一期对应指标的YTD值`。对于率值指标，Y轴单位显示为 (pp)。
*   F-TREND-002: 用户可从预设的指标列表中选择要分析的趋势指标。
*   F-TREND-003: 图表应清晰展示X轴（数据周期）和Y轴（指标值，按全局格式化规则显示）。Y轴下方应有动态单位标签（如 万元, %, pp）。
*   F-TREND-004: 鼠标悬浮在图表上时，应显示该数据点的详细信息 (Tooltip)，数值按全局格式化规则显示，环比数据模式下率值变化显示pp。Tooltip中“变动成本率”的显示名称已更新。
*   F-TREND-005: 支持多条业务线（或合计线，以缩写显示）在同一图表中对比展示（当前实现为单线趋势，未来可考虑多线）。
*   F-TREND-006: 图表应包含图例，清晰标识每条线或每个柱系列的含义（业务类型名称以缩写显示）。
*   F-TREND-007: 图表元素（折线图的数据点、柱状图的柱子）颜色根据其对应业务线（或合计）在该周期的变动成本率动态变化（基于YTD 变动成本率）。柱状图应有数据标签。

### 4.3. 对比气泡图 (F-BUBBLE)
*   F-BUBBLE-001: 使用气泡图比较不同保险类型（以缩写显示）在“当前周期”的表现。
*   F-BUBBLE-002: 用户可从预设的指标列表为X轴、Y轴和气泡大小选择指标。
*   F-BUBBLE-003: 每个气泡代表一个独立的业务类型。
*   F-BUBBLE-004: 鼠标悬浮在气泡上时，应显示该业务类型的缩写名称及X、Y、Z轴的详细数值（按全局格式化规则显示）和单位，以及变动成本率值。
*   F-BUBBLE-005: 移除图表图例。
*   F-BUBBLE-006: X轴和Y轴的刻度应动态适应数据范围，数值按全局格式化规则显示，轴下方应有动态单位标签。
*   F-BUBBLE-007: 气泡颜色根据其对应业务线在该周期的变动成本率动态变化。

### 4.4. 水平条形图排名 (F-RANK)
*   F-RANK-001: 使用水平条形图，根据用户选择的单个指标对各业务类型在“当前周期”进行排名。图表应有足够的显示高度。Y轴清晰显示业务类型缩写名称。
*   F-RANK-002: 用户可从预设的指标列表（包含KPI看板核心指标，排除不适宜排名的）中选择要排名的指标。
*   F-RANK-003: 条形图按指标值降序排列。
*   F-RANK-004: 每个条形代表一个独立的业务类型，并显示其缩写名称和指标值。Tooltip中“变动成本率”的显示名称已更新。
    *   数据标签 (`LabelList`): 条形顶端的数据标签应完整显示，并根据全局格式化规则显示（见6.3节）。
*   F-RANK-005: X轴表示指标值，刻度按全局格式化规则显示，下方应有动态单位标签。
*   F-RANK-006: 条形颜色根据其对应业务线在该周期的变动成本率动态变化。

### 4.5. 占比图 (F-SHARE)
*   F-SHARE-001: 在“排名图”视图之后新增“占比图”视图。
*   F-SHARE-002: 使用**饼图 (Pie Chart)** 展示各独立业务类型（以缩写显示）在所选指标上的贡献占比。饼图扇区本身不显示数据标签。
*   F-SHARE-003: 用户可从预设的指标列表选择指标进行分析。可选指标为**非率值、非占比、非系数的绝对值指标**（如：跟单保费、满期保费、总赔款、费用额、边贡额、保单数量、已报件数、满期保单数量）。
*   F-SHARE-004: 计算逻辑：占比 = (单一业务类型在所选指标上的值) / (全部独立业务类型在所选指标上的总值) \* 100%。
    *   分母的“全部独立业务类型总值”不受当前全局业务类型筛选影响，始终为所有独立业务类型的合计。
    *   分子（即饼图的各个扇区）则根据当前全局业务类型筛选（若有）来展示。若全局未筛选业务类型，则展示所有独立业务类型的占比。
*   F-SHARE-005: 饼图扇区颜色根据其对应业务线在该周期的变动成本率动态变化。Tooltip中“变动成本率”的显示名称已更新。
*   F-SHARE-006: 鼠标悬浮在扇区上时，应显示业务类型缩写名称、指标原始值、占比百分比和变动成本率值。
*   F-SHARE-007: **图例自定义显示**：图例按业务类型占比从高到低排列，分为3列展示，每列最多显示5个业务类型。每个图例项清晰标识业务类型的缩写名称及占比百分比（例如：“非营客新 (35.2%)”）。
*   F-SHARE-008: 支持独立的AI分析功能，解读主要占比构成和变动成本率表现。

### 4.6. 帕累托图 (F-PARETO)
*   F-PARETO-001: 在“占比图”视图之后新增“帕累托图”视图。
*   F-PARETO-002: 使用**组合图 (Composed Chart)**，包含按贡献降序排列的业务类型柱状图（左Y轴）和累计贡献百分比折线图（右Y轴）。业务类型名称以缩写显示。X轴业务类型标签应**横向显示**。
*   F-PARETO-003: 用户可从与占比图相同的指标列表选择指标进行分析（非率值、非占比、非系数的绝对值指标）。
*   F-PARETO-004: 计算逻辑：
    *   各业务类型按所选指标值降序排列。
    *   计算每个业务类型的累计贡献百分比。
*   F-PARETO-005: 柱状图颜色根据其对应业务线在该周期的变动成本率动态变化。折线图可使用固定对比色。Tooltip中“变动成本率”的显示名称已更新。
*   F-PARETO-006: 鼠标悬浮时，应显示业务类型缩写名称、指标原始值、累计百分比和变动成本率值。X轴显示排序后的业务类型缩写名称。
*   F-PARETO-007: 图例标识指标值（柱）和累计百分比（线）。
*   F-PARETO-008: 支持独立的AI分析功能，解读贡献关键少数（如前80%）及其变动成本率表现。

### 4.7. 数据表显示 (F-TABLE)
*   F-TABLE-001: 以表格形式显示每个业务线（或合计行，业务线名称以缩写显示）的各项核心指标的原始值和计算值。
*   F-TABLE-002: 表格列应包括业务线名称、跟单保费、总赔款、保单数量、满期赔付率、费用率等核心指标。数值均按全局格式化规则显示。
*   F-TABLE-003: 当分析模式为“当周发生额分析”（环比数据）时，表格应额外显示各指标与“对比周期”的变化百分比（或百分点），按全局格式化规则显示变化值。“对比周期”可以是默认对比上一周期，也可以是用户自定义选择的周期。对比列名会明确指出对比的周期。
*   F-TABLE-004: 数值按全局格式化规则显示（见6.3节）。
*   F-TABLE-005: 变化值应使用箭头（上升/下降/持平）和颜色（根据指标业务含义和变动成本率规则）进行可视化提示。

### 4.8. 全局筛选与控制
*   F-CTRL-001: 分析模式切换 (累计数据 / 当周发生额)
*   F-CTRL-002: 当前数据周期选择
*   F-CTRL-002B: 对比数据周期选择
    *   提供下拉菜单，允许用户选择一个周期作为对比基准。
    *   可选项为所有周期列表，排除当前已选的“当前数据周期”。
    *   提供“默认对比”选项，选中后恢复为基于“当前数据周期”的直接前一个周期进行对比分析。
    *   选择后，KPI看板和数据表的对比数据将基于此选择更新。图表（趋势图、气泡图、排名图、占比图、帕累托图）本身不直接受此全局对比周期影响，它们展示的是当前周期的数据或时间序列。
*   F-CTRL-003: 业务类型筛选
*   F-CTRL-004: 数据导出 (导出CSV时，如果选择了自定义对比周期，文件名和列名应体现)
*   F-CTRL-005: 视图切换 (KPI看板, 趋势图, 气泡图, 排名图, 占比图, 帕累托图, 数据表)
*   F-CTRL-006: 数据源选择

### 4.9. AI 智能分析
*   F-AI-001: 总体业务摘要
    *   AI模型根据当前筛选条件（数据源、当前周期、自定义对比周期（如有）、业务类型、分析模式）下的KPI数据和主要业务线表现，生成结构化摘要。输出使用Markdown加粗突出重点，**语言必须为中文**。该摘要显示在所有视图的顶部。
*   F-AI-002: 图表AI分析
    *   针对趋势图、气泡图、排名图、占比图、帕累托图，提供独立的AI分析功能。
    *   AI分析的功能按钮（例如“生成XX图AI分析”）和AI生成的文本内容显示区域，**统一放置在对应图表的下方**。
    *   AI模型根据当前图表显示的数据（基于当前周期，趋势图会考虑环比模式下的YTD差额，业务类型以缩写传递）和相关上下文生成结构化解读。输出使用Markdown加粗突出重点，并解释变动成本率颜色背后的业务含义（而不是直接描述颜色），**语言必须为中文**。
    *   AI分析文本字体大小应与总体摘要保持一致。

## 5. 非功能性需求
(保持不变)

## 6. 设计与用户体验
(保持不变，但6.3节格式化规则是核心)

### 6.3. 全局数值显示格式化规则
*   率/占比类 (如：满期赔付率, 费用率, 保费占比等):
    *   保留 1位 小数。
    *   必须显示 百分号 (%)。
*   自主系数:
    *   保留 3位 小数。
    *   不显示单位。
*   单均保费、案均赔款:
    *   单位：元。
    *   取 整数 (带千位分隔符，如 "1,234")。
    *   不显示单位。
*   其余保费、赔款、费用额、边贡额等金额类:
    *   单位：万元。
    *   取 整数 (带千位分隔符，如 "1,234")。
    *   不显示单位。
*   保单数量、已报件数、满期保单件数等计数类:
    *   取 整数 (带千位分隔符，如 "1,234")。
    *   不显示单位。
*   其他数值:
    *   取 整数 (带千位分隔符，如 "1,234")。
    *   不显示单位。
*   通用:
    *   所有最终显示的数值本身不带单位 (如“元”、“万元”、“件”)，百分比除外（带“%”）。单位信息依赖于上下文（如KPI卡片标题、图表轴名称、表格列头、KPI卡片右上角单位显示）。
    *   无效或缺失数据显示为 "-"。
*   KPI对比变化值:
    *   百分比变化（如保费增长率）: "X.X%"。
    *   绝对值变化：根据主指标的格式规则显示（不带单位，但带千位分隔符）。
    *   百分点变化（如费率变化）: "X.X pp"。

## 7. 数据需求
(保持不变)

## 8. 未来展望 (可选)
*   用户自定义KPI看板
*   更细粒度的下钻分析
*   预测功能
*   更高级的AI洞察
*   权限管理
*   数据库集成深化

## 9. 附录
(保持不变)

---
文档审批
(保持不变)

---
修订历史

| 版本 | 日期       | 修订人     | 修订说明                               |
| :--- | :--------- | :------- | :------------------------------------- |
| ...  | ...        | ...      | ...                                    |
| 2.5  | 2024-05-28 | AI项目大师 | 更新KPI卡片对比标签为动态“对比 [周期名称]”；图表及数据表中业务类型显示为缩写；文档同步。 |
| 2.6  | 2024-05-28 | AI项目大师 | 1. 术语"VCR"统一为"变动成本率"。2. KPI看板对比信息统一显示在看板下方，移除卡片内独立标签，调整卡片最小高度。3. AI分析字体大小统一，内容强制中文。 |
| 2.7  | 2024-05-28 | AI项目大师 | 优化占比图：移除扇区数据标签，图例改为3列显示（每列最多5项，按占比降序并显示百分比）。优化帕累托图：X轴业务类型标签改为横向显示。 |
