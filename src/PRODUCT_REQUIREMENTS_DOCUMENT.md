
# 产品需求文档 (PRD) - 车险经营分析周报

**版本**: 3.7.0 (AI功能已禁用)
**最后更新日期**: (当前日期)
**负责人**: AI项目大师

## 1. 引言

### 1.1. 目的
本文档旨在明确“车险经营分析周报”应用（以下简称“本应用”）的产品需求。本应用当前版本已**禁用**所有AI智能分析功能，但保留了用户认证和数据可视化能力。

### 1.2. 范围
本应用的核心目标是为车险业务分析人员和管理层提供一个直观、高效、安全的数据可视化分析平台。数据源通过静态JSON文件提供。**AI分析功能已全局禁用。**

### 1.3. 目标受众
*   车险业务分析师
*   车险部门经理/管理层

### 1.4. 术语定义
*   YTD (Year To Date): 本年迄今累计。
*   PoP (Period over Period): 环比。
    *   KPI看板/数据表中的“环比数据”模式下的对比变化值逻辑：
        *   当前值 = “当前期PoP值” (即 `当前期YTD - 当前期的上一期YTD`)。
        *   对比基准值 = “对比期PoP值” (即 `对比期YTD - 对比期的上一期YTD`)。
        *   卡片上显示的变化是基于这两个PoP值之间的差异计算的。
        *   对比标签会根据用户选择的对比周期或默认的上一周期动态显示为“对比 [周期名称]”（例如 “对比 2025年第22周” 或 “对比 上一期”）。
    *   趋势图中的环比数据 (analysisMode='periodOverPeriod')：对于所有指标（包括率值和绝对值），图表上每个点的值代表 `当前期对应指标的YTD值 - 上一期对应指标的YTD值`。
*   自定义对比期: 用户可从周期列表中选择任一周期作为当前周期的对比基准。
*   KPI (Key Performance Indicator): 关键绩效指标。
*   业务类型: 指不同的车险产品线或分类。图表和数据表中显示的业务类型名称会使用预定义的缩写。
*   数据周期: 数据统计的时间单位，本应用中指“周”。周数据显示为上周日至本周六的数据，例如2025年第24周的数据范围是2025年6月8日（周日）至2025年6月14日（周六）。趋势图X轴标签将显示当周最后一天（周六）的日期，格式为 "YY-MM-DD"。
*   累计值分析: 基于YTD数据的分析。
*   当周发生额分析 (analysisMode='periodOverPeriod'):
    *   KPI看板/数据表：主数据显示的是“当前期PoP值”。对比数据显示的是与“对比期PoP值”的差异。
    *   趋势图：图表上每个点的值代表 `当前期对应指标的YTD值 - 上一期对应指标的YTD值`。
*   变动成本率 (Variable Cost Ratio): 指满期赔付率与费用率之和。
*   pp (percentage points): 百分点。
*   **数据源 (Data Source)**: 通过静态JSON文件 `public/data/insurance_data.json` 提供。
*   **Firebase Authentication**: 用于用户登录和访问控制。
*   详细的指标定义和计算逻辑请参考项目根目录下的 `FIELD_DICTIONARY_V4.md` 文件。

## 2. 产品概述

### 2.1. 产品愿景
打造一款安全、高效、易用的车险经营数据分析工具。

### 2.2. 产品目标
*   提升分析效率：通过自动化的数据处理和可视化展示。
*   增强数据洞察：提供多维度、交互式的分析功能。
*   统一数据口径：确保核心指标的计算逻辑和数据来源统一。
*   **安全访问控制**: 通过 Firebase Authentication 实现用户登录。
*   **AI功能状态**: 所有AI智能摘要和分析功能当前版本已全局禁用。

### 2.3. 核心价值
*   准确性：基于周度数据，提供准确的业务指标。
*   可视化与直观性：通过丰富的图表和卡片，使复杂数据易于理解。趋势图X轴标签将显示当周最后一天（周六）的日期，格式为 "YY-MM-DD"，并且在“累计”模式下标签将水平显示，布局已优化防止溢出。
*   灵活性与可配置性：支持分析模式切换、业务类型筛选、数据周期选择、自定义对比周期选择。
*   **数据文件访问性**: 原始数据 `insurance_data.json` 位于 `public/data` 目录，可通过直接URL访问（不受登录保护）。
*   **AI功能说明**: 应用界面将提示AI功能已禁用。

## 3. 用户画像与场景

### 3.1. 用户画像
*   李明 (业务分析师)
*   王总 (部门经理)

### 3.2. 核心使用场景
*   场景一：登录并进行日常业务监控与周报生成
    *   李明打开应用，被重定向到登录页。使用其 Firebase Authentication 凭证（例如，邮箱/密码）登录。
    *   登录成功后，应用加载保险数据。
    *   默认看到最新一周的累计数据KPI看板。**KPI看板下方的总体业务摘要功能已禁用。**
    *   他选择周期、业务类型。
    *   他切换视图（趋势、气泡、排名、占比、帕累托、数据表）。趋势图X轴标签会显示当周最后一天（周六）的日期 (YY-MM-DD)，方便理解，且布局优化确保标签完整显示。 **各图表下方的独立AI分析功能已禁用。**
    *   他使用“导出”功能导出数据。
    *   分析完毕后，点击“登出”按钮。
*   场景二：管理层快速概览
    *   王总使用其凭证登录应用。应用加载数据。首先浏览KPI看板。然后可能切换到其他图表视图。**所有AI分析功能已禁用。**
*   场景三：专项问题分析 (特定周期对比)
    *   同上，登录后，应用加载数据。利用KPI看板和各图表进行数据分析。

## 4. 核心功能需求

### 4.0. 用户认证 (F-AUTH) - Firebase Authentication
*   (同V3.6.0)

### 4.1. 数据提供 (F-DATA) - 静态JSON
*   **F-DATA-001: 公开数据文件**: 原始的 `insurance_data.json` 文件位于 `public/data` 目录，可通过直接URL公开访问。
*   **F-DATA-002: 前端获取**: 前端应用直接通过 `fetch('/data/insurance_data.json')` 获取全部保险数据。

### 4.2. KPI 看板 (F-KPI)
*   (同V3.6.0，但其下方的AI智能总体业务摘要功能已禁用，相关UI提示AI功能已禁用)

### 4.3. 趋势分析 (F-TREND)
*   (同V3.6.0，但其下方的独立AI图表分析功能已禁用)

### 4.4. 对比气泡图 (F-BUBBLE)
*   (同V3.6.0，但其下方的独立AI图表分析功能已禁用)

### 4.5. 水平条形图排名 (F-RANK)
*   (同V3.6.0，但其下方的独立AI图表分析功能已禁用)

### 4.6. 占比图 (F-SHARE)
*   (同V3.6.0，但其下方的独立AI图表分析功能已禁用)

### 4.7. 帕累托图 (F-PARETO)
*   (同V3.6.0，但其下方的独立AI图表分析功能已禁用)

### 4.8. 数据表显示 (F-TABLE)
*   (同V3.6.0)

### 4.9. 全局筛选与控制
*   (同V3.6.0，但不再有触发AI摘要的按钮)

### 4.10. AI 智能分析 (已禁用)
*   F-AI-001: **全局禁用**: 所有AI相关的摘要和图表分析功能均已在前端移除或禁用。
*   F-AI-002: **UI提示**: 应用界面会在原AI功能区域提示用户AI功能已禁用。
*   F-AI-003: **后端保留**: 后端Firebase Function (`generateAiSummaryProxy`) 和Genkit flow代码保留，但前端不再调用。

## 5. 非功能性需求
*   (同V3.6.0，但移除AI相关的安全和性能需求，强调数据文件是公开的)
*   NF-SEC-001: **数据文件公开**: 原始数据文件 `insurance_data.json` 位于 `public/data` 目录，可通过URL直接访问，不受登录保护。
*   NF-PERF-001: 数据请求为异步，UI应有加载状态提示，避免阻塞。
*   NF-UI-001: 图表布局: 所有图表应在其指定容器内正确显示，避免内容溢出。趋势图X轴标签在累计模式下水平显示，格式为YY-MM-DD。

## 6. 设计与用户体验
*   (同V3.6.0，但登录流程描述更新为Firebase Auth)
*   **6.1 登录流程**:
    *   用户首次访问应用时，若未登录，则自动跳转到登录页面。
    *   登录页面使用Firebase Authentication，例如邮箱/密码登录。
    *   登录成功后跳转到主仪表盘页面。
    *   登录失败时，在登录页面显示Firebase提供的错误提示。
*   6.4 AI交互:
    *   **AI功能已禁用**: 应用头部不再有AI摘要按钮。各图表下方不再有AI分析模块和按钮。
    *   UI将提示AI功能已禁用。
*   6.5 图表可读性: 趋势图的X轴标签将清晰显示当周最后一天（周六）的日期，格式为 "YY-MM-DD"，并在累计模式下水平展示。
*   **6.6 用户状态**: 应用头部清晰显示用户登录状态（例如通过当前用户邮箱和“登出”按钮）。

### 6.3. 全局数值显示格式化规则
*   (同V3.6.0)

## 7. 数据需求
*   主要数据源: **静态JSON文件 `public/data/insurance_data.json`**。
*   **Firebase前端配置**: 需要在前端配置Firebase SDK (API Key, Auth Domain等)，建议通过环境变量管理。

## 8. 未来展望 (可选)
*   (其他无变化)
*   AI功能未来可能根据需求重新评估并启用。

## 9. 附录
*   `FIELD_DICTIONARY_V4.md`
*   `FIELD_LINEAGE.md` (若存在)
*   `ISSUES_LOG.md`

---
修订历史

| 版本  | 日期       | 修订人     | 修订说明                                                                                                |
| :---- | :--------- | :------- | :------------------------------------------------------------------------------------------------------ |
| ...   | ...        | ...      | ... (保留之前所有记录)                                                                                    |
| 3.6.0 | (先前日期) | AI项目大师 | 集成Firebase Authentication。为保护数据和AI功能，创建了Firebase Function代理（但AI Function的404问题正在处理）。 |
| 3.7.0 | (当前日期) | AI项目大师 | 全局禁用了所有AI智能分析功能，移除了前端相关UI和逻辑。数据源仍为静态JSON。文档更新以反映AI功能禁用状态。 |

    